---
title: "Seminārs, datu kopa: cukurniedres"
author: "Annija Tija Berņikova-Bondare, Marta Zemīte, Katrīna Grebeško, Margarita Baranova"
output: html_document
---

Šī projekta dati, kods un analīzes tiek pārvaldītas, izmantojot Git versiju kontroli un GitHub repozitoriju (https://github.com/margarita-baranova/biometrija-seminars).

Darba uzdevumi:



Hipotēzes: 

Ir statistiski būtiska atšķirība cukura un šķiedru daudzumā starp  ziemeļu un dienvidu reģionos audzētajām cukurniedrēm.
 
Starp cukurniedru vecumu un šķiedru un cukuru daudzumu pastāv statistiski būtiska korelācija.vai rakstīt vecākas niedres uzrādīs mazāku šķiedru un cukura daudzumu

Faktori: augsnes tips, cukurniedru šķirne vai vecums, būtiski ietekmē cukurniedru ražu (tonnas/hektārs).

Laukiem ar lielākām platībām būs lielākas cukurniedru ražas.

#  Datu apraksts: šis vel tiks mainīts

Datu failā ir informacija par 1005 cukurniedru laukiem.

Faila kolonnas:
1: DistrictPosition - lauka novietojums valsts dienvidos vai ziemeļos (Autralija)
2: SoilName - augsnes tips
3: Area - lauka lielums hektaros
4: Variety - cukurniedru variatate
5: Age - gadu skaits cik niedres ataudzetas pirms novaksanas
6: HarvestMonth - razas novaksanas menesis
7: HarvestDuration - razas novaksanas ilgums (dienas)
8: Tonn_Hect - razas apjoms tonnas uz hektaru
9: Fibre - skiedru daudzums (procentos)
10: Sugar - cukuru daudzums (procentos)
11:- jul_96-dec_97 - nokrisnu daudzums atbilstosaja menesi/gada

#  Metodes:

Šī projekta dati, kods un analīzes tiek pārvaldītas, izmantojot Git versiju kontroli un GitHub repozitoriju (https://github.com/margarita-baranova/biometrija-seminars).
Datu normalitātes pārbaudei izmantoti QQ-ploti un Boxplot diagrammas. Datu analīzei veikti neparametriskie testi kā  Wilkoksona tests. Kā arī veikta regresijas analīze un datu vizualizācija.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Bibliotēku ielāde

```{r, echo=FALSE}
suppressPackageStartupMessages({
library(readxl)
library(qqplotr)
library(cowplot)
library(ltm)
library(tidyverse)
library(qqplotr)
library(readxl)
library(Hmisc)
library(EnvStats)
library(rstatix)
library(pwr)
library(rcompanion)
library(car)
library(agricolae)
library(lindia)
library(MuMIn)
  
})                             
```

## Dati

```{r,  echo=FALSE}
cukur<-read_excel("cukurniedres_dati.xlsx")
head(cukur)
summary(cukur)
str(cukur)

cukurs_atlasitie = cukur %>%
  mutate(MonthName = month.name[HarvestMonth]) %>% 
  select(DistrictPosition, SoilName, Age, Area, Variety, Tonn_Hect, Fibre, Sugar, MonthName)

```


## Cukura daudzums, ziemeļos vai dienvidos:
### Normalitātes pārbaude (QQ-plots)

```{r,  echo=FALSE}

ggplot(cukur, aes(sample = Sugar)) + facet_wrap(~DistrictPosition) +
  geom_qq_band() + stat_qq_line() + stat_qq_point() +
  labs(x = "Teorētiskās kvantiles", y = "Paraugkopas kvantiles")

```

QQ-plots: Normāla sadalījuma pieņēmums, iespējams, ir derīgs tikai Ziemeļu (N) grupai, jo tās datu punkti QQ-plota diagrammā atrodas tuvu teorētiskajai līnijai.
Savukārt Dienvidu (S) grupas dati novirzās no normālā sadalījuma.

### Datu novērtējums ar Boxplot

```{r,  echo=FALSE}

ggplot(cukur, aes(x = DistrictPosition, y = Sugar, fill = DistrictPosition)) +
  geom_boxplot() +
  labs(
    title = "Cukura daudzuma salīdzinājums starp ziemeļu un dienvidu reģioniem",
    x = "Reģions (N = Ziemeļi, S = Dienvidi)",
    y = "Cukura daudzums"
  ) +
  theme_minimal() +
  scale_fill_manual(values = c("N" = "lightblue", "S" = "lightgreen"))

```

Boxplot analīze: Abās grupās ir redzamas ietekmīgās vērtības.

Secinājums: Dati neatbilst normālam sadalījumam, tāpēc jāizmanto neparametriskās metodes, piemēram, Vilkoksona tests.

### Vilkoksona tests divām neatkarīgām paraugkopām:

```{r,  echo=FALSE}

wilcox.test(cukur$Sugar ~ cukur$DistrictPosition)


wilcox_test_result <- wilcox.test(Sugar ~ DistrictPosition, data = cukur)
print(wilcox_test_result)

-1/(exp(1)*2.2e-16*log(2.2e-16))

```

Secinājums: Pie būtiskuma līmeņa α=0.05, starp Ziemeļu un Dienvidu laukumiem cukurniedru ražas apjoma vērtību sadalījumiem pastāv statistiski būtiska atšķirība (W(1005)=195053 p<0.0001).

Noteikta milzīga reizes atšķirība (4.638126e+13), , kas norāda, ka viena no grupām satur ievērojami vairāk cukura nekā otra.

### Efekta lieluma novērtējums

```{r,  echo=FALSE}

wilcox_effsize(data=cukur,Sugar~DistrictPosition,paired=FALSE,ci=TRUE) 

```

Secinajums: novērotais efekta apjoms ir vidēji izteikts - videja starpıba ir 0.483 standartnovirzes (95% CI 0.53...0.43).

## Šķiedru daudzums ziemeļos vai dienvidos:

### Normalitātes pārbaude (QQ-plots)

```{r,  echo=FALSE}
ggplot(cukur, aes(sample = Fibre)) + facet_wrap(~DistrictPosition) +
  geom_qq_band() + stat_qq_line() + stat_qq_point() +
  labs(x = "Teorētiskās kvantiles", y = "Paraugkopas kvantiles") 

```

QQ-plots: Dati neatbilst normālajam sadalījumam.

### Datu novērtējums ar Boxplot

```{r,  echo=FALSE}

ggplot(cukur, aes(x = DistrictPosition, y = Fibre, fill = DistrictPosition)) +
  geom_boxplot() +
  labs(
    title = "Šķiedrvielu apjoma salīdzinājums starp ziemeļu un dienvidu reģioniem",
    x = "Reģions (N = Ziemeļi, S = Dienvidi)",
    y = "Šķiedrvielas daudzums"
  ) +
  theme_minimal() +
  scale_fill_manual(values = c("N" = "lightblue", "S" = "lightgreen"))

```

Boxplot analīze: Abās grupās ir redzamas ietekmīgās vērtības.

Secinājums: Dati neatbilst normālam sadalījumam, tāpēc jāizmanto neparametriskās metodes, piemēram, Vilkoksona tests.

### Vilkoksona tests divām neatkarīgām paraugkopām:

```{r,  echo=FALSE}

wilcox.test(cukur$Fibre ~ cukur$DistrictPosition)


wilcox_test_result <- wilcox.test(Fibre ~ DistrictPosition, data = cukur)
print(wilcox_test_result)

-1/(exp(1)*0.01405*log(0.01405)) 


```

Vilkoksona testa rezultāti: Pie būtiskuma līmeņa α=0.05, starp Ziemeļu (N) un Dienvidu (S) laukumiem cukurniedru šķiedrvielu (Fibre) vērtību sadalījumos pastāv statistiski būtiska atšķirība (W(1005)=113739W, p=0.01405). Atšķirība starp grupām nav tik izteikta kā cukura gadījumā.

Relatīvā atšķirība: Noteikta neliela relatīvā atšķirība (6.14).


### Efekta lieluma novērtējums

```{r,  echo=FALSE}

wilcox_effsize(data=cukur,Fibre~DistrictPosition,paired=FALSE,ci=TRUE) #efekta apjoms ir 0.076, kas ir ļoti vājš efekts

```

Secinajums: novērotais efekta apjoms ir vāji izteikts - videja starpıba ir 0.0775 standartnovirzes (95% CI 0.02...0.14).

## Ražas apjoms (t/ha), ziemeļos vai dienvidos:

### Normalitātes pārbaude (QQ-plots)

```{r,  echo=FALSE}

ggplot(cukur, aes(sample = Tonn_Hect)) + facet_wrap(~DistrictPosition) +
  geom_qq_band() + stat_qq_line() + stat_qq_point() +
  labs(x = "Teorētiskās kvantiles", y = "Paraugkopas kvantiles")

```

QQ-plots: Dati neatbilst normālajam sadalījumam.

### Datu novērtējums ar Boxplot

```{r,  echo=FALSE}

ggplot(cukur, aes(x = DistrictPosition, y = Tonn_Hect, fill = DistrictPosition)) +
  geom_boxplot() +
  labs(
    title = "Ražas salīdzinājums starp ziemeļu un dienvidu reģioniem",
    x = "Reģions (N = Ziemeļi, S = Dienvidi)",
    y = "Raža (tonnas/hektārs)"
  ) +
  theme_minimal() +
  scale_fill_manual(values = c("N" = "lightblue", "S" = "lightgreen"))

```

Boxplot analīze: Abās grupās ir redzamas ietekmīgās vērtības.

Secinājums: Dati neatbilst normālam sadalījumam, tāpēc jāizmanto neparametriskās metodes, piemēram, Vilkoksona tests.

### Vilkoksona tests divām neatkarīgām paraugkopām:

```{r,  echo=FALSE}

wilcox.test(cukur$Tonn_Hect ~ cukur$DistrictPosition)

wilcox_test_result <- wilcox.test(Tonn_Hect ~ DistrictPosition, data = cukur)
print(wilcox_test_result)

-1/(exp(1)*7.126e-06*log(7.126e-06))

```

Secinājums: Pie būtiskuma līmeņa α=0.05, starp Ziemeļu un Dienvidu laukumiem cukurniedru ražas apjoma vērtību sadalījumiem pastāv statistiski būtiska atšķirība (W(1005) = 145532; p<0.0001).

Noteikta liela reizes atšķirība (4356), kas norāda, ka viena no grupām ir ar ievērojami lielāku vidējo saražoto ražas daudzumu.

### Efekta lieluma novērtējums

```{r,  echo=FALSE}

wilcox_effsize(data=cukur,Tonn_Hect~DistrictPosition,paired=FALSE,ci=TRUE) #efekta apjoms ir 0.142, kas ir vājš efekts

```

Secinājums: novērotais efekta apjoms ir vāji izteikts - videja starpıba ir 0.142 standartnovirzes (95% CI 0.2...0.08).

# Regresijas analīze:

```{r,  echo=FALSE}

modelis_raza1 <- lm(formula = Tonn_Hect ~  Age + MonthName, data = cukurs_atlasitie)
summary(modelis_raza1) #neņēmām, jo mediāna ļoti nobīdīta no nulles (-68.56) un Radj ir 0.0086
gg_diagnose(modelis_raza1, ncol = 3) 

```

Regresijas modelis izskaidro tikai 0.87 % no vērtību variācijas, modelis kopumā ir būtisks (F(2,1002)=2.463, p= 0.02275 ). Taču atsevišķu regresoru ietekme nav statistiski nozīmīga. Arī Kuka distances pārsniedz robežlīniju, atlikumu vērtības nav normāli sadalītas

```{r,  echo=FALSE}

modelis_raza2 <- lm(formula = Tonn_Hect ~  Age + HarvestMonth, data = cukur)
summary(modelis_raza2) #neņemam, jo mediāna ir vēl vairāk nobīdīta no nulles (-70.83) un Radj ir 0.00037

```

Regresijas modelis izskaidro tikai 0.03 % no vērtību variācijas, un modelis kopumā nav būtisks (F(2,1002)=1.187, p= 0.3056 ). Turklāt atsevišķu regresoru ietekme nav statistiski nozīmīga.

## Jaukta efekta modeļi
### Cukura daudzums kā atkarīgais mainīgais

```{r,  echo=FALSE}

model1 <- lm(Sugar ~ Area + Age + HarvestMonth, data = cukur)
summary(model1) 

```

Regresijas modelis izskaidro tikai 7,8% no vērtību variēšanas, modelis kopumā ir būtisks (F(3,1001)=29.22; p < 2.2e-16), bet Harvestmonth ietekme nav būtiska. 


```{r,  echo=FALSE}

model4 <- lm(Sugar ~ SoilName + DistrictPosition, data = cukur)
summary(model4)

gg_diagnose(model4, ncol = 2) 


```

Regresijas modelis izskaidro tikai 31,4% no vērtību variēšanas, modelis kopumā ir būtisks (F(981;23)=20.95, p < 0.0001). Turklāt atsevišķu regresoru ietekmes nav statistiski nozīmīgas.Pēc modeļa diagnostikas novērots, ka atlikumu vērtības izskatās normāli sadalītas, Cook's distance vertıbas atbilstošas, taču ir dažas ietekmīgās vērtības.


```{r,  echo=FALSE}
 
model6 <- lm(Sugar ~ SoilName * DistrictPosition, data = cukur) 
summary(model6) 

```

Regresijas modelis izskaidro tikai 31,35% no vērtību variēšanas, modelis kopumā ir būtisks, taču daudz iztrūkstošo vērtību.

```{r,  echo=FALSE}
 
model7 <- lm(Sugar ~ SoilName + Variety, data = cukur)
summary(model7) 

```

Regresijas modelis izskaidro tikai 32,45% no vērtību variēšanas, modelis kopumā ir būtisks (F(962;42)=12.48, p < 0.0001). Taču atsevišķu faktoru ietekmes nav statistiski nozīmīgas.Pēc modeļa diagnostikas novērots, ka ir vairākas ietekmīgās vērtības, atlikumu vērtības izskatās normāli sadalītas.

```{r,  echo=FALSE}
 
cukur$prognoze <- predict(model7)
cukur$atlikums <- resid(model7)
ggplot(cukur, aes(prognoze, atlikums)) + geom_point()
qqPlot(residuals(model7))

```

Diagramma neuzrāda acīmredzamas sistemātiskas kļūdas (piemēram, izliekumu vai līkni), taču atlikumu lielums norāda, kair diezgan plaša atlikumu izkliede ap nulli, kas varētu norādī uz neprecizitāti. Kā arī modelis izskaidro tikai nelielu datu variāciju. Atlikumi neatbilst precīzi normālam sadalījumam.

```{r,  echo=FALSE}
 
model11<- lm(Sugar ~ Variety + Age, data=cukur) 
summary(model11) 

gg_diagnose(model11, ncol = 2)

```

Regresijas modelis izskaidro tikai 21.4% no vērtību variēšanas, modelis kopumā ir būtisks (F(983;21)=14.07, p < 0.0001). Taču atsevišķu faktoru ietekmes nav statistiski nozīmīgas. Pēc modeļa diagnostikas novērots, ka atlikumu vērtības izskatās normāli sadalītas, bet mazo vērtību galā ir nobīde, ir ietekmīgie novērojumi.

```{r,  echo=FALSE}
 
model12<- lm(Sugar ~ Variety, data=cukur)
summary(model12) 
gg_diagnose(model12, ncol = 2) 


```

Regresijas modelis izskaidro tikai 16.9% no vērtību variēšanas, modelis kopumā ir būtisks (F(984;20)=11.21, p < 0.0001). Taču atsevišķu faktoru ietekmes nav statistiski nozīmīgas. Pēc modeļa diagnostikas novērots, ka atlikumu vērtības izskatās normāli sadalītas, bet ir ietekmīgās vērtības.

```{r,  echo=FALSE}
 
AICc_model1 <- AICc(model1)
AICc_model4 <- AICc(model4)
AICc_model6 <- AICc(model6)
AICc_model7 <- AICc(model7)
AICc_model11 <- AICc(model11)


AICc_values <- data.frame(Model = c("Model1", "Model4", "Model6", "Model7", "Model11"),
                          AICc = c(AICc_model1, AICc_model4, AICc_model6, AICc_model7, AICc_model11))

print(AICc_values)

```

Pēc AIC vertības  modelis 4.  ir labākais, jo šī modeļa AICc vertıba ir mazākā.

```{r,  echo=FALSE}
 
sjPlot::tab_model(model4)

```

*Modeļa raksturojums:*
Vairums augsnes tipu (piemēram, Buchan, Bulgun, Canoe, Galmara, Malbon, Mission, u.c.) parāda statistiski nozīmīgu ietekmi uz cukura daudzumu, kas liecina, ka augsnes veids var būt svarīgs faktors. Modelis kopumā izskaidro 32.14% cukura daudzuma variācijas.

### Šķiedru daudzums kā atkarīgais mainīgais:

```{r,  echo=FALSE}
 
model9 <- lm(Fibre ~ SoilName + Variety, data = cukur)
summary(model9) 
gg_diagnose(model9, ncol = 2)

```

Regresijas modelis izskaidro tikai 18,34% no vērtību variēšanas, modelis kopumā ir būtisks (F(962;42)=6.369, p < 0.0001). Taču atsevišķu faktoru ietekmes nav statistiski nozīmīgas. Pēc modeļa diagnostikas novērots, ka ir vairākas ietekmīgās vērtības, atlikumu vērtības izskatās normāli sadalītas.

```{r,  echo=FALSE}
 
model13<- lm(Fibre ~ Variety + Age, data=cukur) 
summary(model13) 
gg_diagnose(model13, ncol = 2)


```

Regresijas modelis izskaidro tikai 16.3% no vērtību variēšanas, modelis kopumā ir būtisks (F(983;21)=10.32, p < 0.0001). Taču atsevišķu faktoru ietekmes nav statistiski nozīmīgas. Pēc modeļa diagnostikas novērots, ka atlikumu vērtības izskatās normāli sadalītas, bet lielo vērtību galā ir novirze, kā arī ir ietekmīgās vērtības.

```{r,  echo=FALSE}
 
MuMIn::AICc(model9, model12, model13) 

```

Pēc AIC vertības  modelis 9. ir labākais, jo šı modeļa AICc vertıba ir mazākā.

```{r,  echo=FALSE}
 
sjPlot::tab_model(model9)

```

*Modeļa raksturojums:*
Dažām augsnēm, piemēram, Galmara, Inlet un Silkwood, ir statistiski nozīmīga ietekme uz šķiedrvielu daudzumu, taču vairums augšņu kā arī šķirņu nav statistiski nozīmīgas šajā modelī. Modelis izskaidro tikai nelielu daļu šķiedrvielu daudzuma variācijas (18.3%), kas norāda, ka ir citi svarīgi faktori, kas nav iekļauti šajā modelī.


```{r, echo=FALSE}
suppressPackageStartupMessages({
library(lme4)
library(lmerTest)
library(nlme)
})                             
```

### Jauktā modeļa (lmer) izveide un diagnostika

```{r,  echo=FALSE}
 
modelis_lmer1 <- lmer(Tonn_Hect ~ Area + Age + HarvestMonth + (1|SoilName), data = cukur)
summary(modelis_lmer1)

plot(modelis_lmer1)

```

Modelis ir statistiski būtisks, residuals liecina, ka lielākā daļa vērtību koncentrējas ap nulli (mediāna = -0.0355).



### Pievienojot modelim mainīgo cukurniedru variatāti  (variety):

```{r,  echo=FALSE}
 
model_variety <- lmer(Tonn_Hect ~ Area + Age + HarvestMonth + (1|SoilName) + (1|Variety), data = cukur)
summary(model_variety)

sjPlot::tab_model(model_variety)


```

Fiksētie efekti izskaidro 70.5% no variācijas, Novērojama ļoti maza ietekme varietāte (1.776).

#Jauktu efektu modeļu salīdzinājums:

```{r,  echo=FALSE}
 
MuMIn::AICc(modelis_lmer1,model_variety) 

```

Pec AIC vertıbas vienkāršākais modelis (1. modelis) ir labāks, jo šı modeļa AICc vertıba ir  mazaka nekā 2. modeļa.
### Modeļa rezultātu tabula

```{r,  echo=FALSE}
 
sjPlot::tab_model(modelis_lmer1)

```

*Modeļa raksturojums:*
Palielinot platību, raža palielinās par 86.46 tonnām/hektārā (CI: 83.08 – 89.85). Šī ir būtiska ietekme (p < 0.001).
Palielinoties vecumam par vienu gadu, raža samazinās par 12.70 tonnām/hektārā (CI: -17.30 – -8.11). Šī ietekme ir būtiska (p < 0.001). Ar katru nākamo ražas mēnesi raža samazinās par 5.53 tonnām/hektārā (CI: -10.56 – -0.51). Ietekme ir mazāk būtiska, bet statistiski nozīmīga (p = 0.031).



#  Secinājumi:

1. Ziemeļos cukura daudzums un ražas apjoms ir ievērojami augstāks nekā Dienvidos, taču šķiedru daudzums starp reģioniem atšķiras mazāk. Atšķirības starp reģioniem ir statistiski nozīmīgas, bet efekta lielumi liecina, ka šīs atšķirības nav ļoti izteiktas.

2. Augsnes veids (SoilName) ir viens no svarīgākajiem faktoriem cukura un šķiedru daudzuma variācijā. Platība (Area) ir svarīgs faktors ražas prognozēšanā, kas apstiprināts jauktajā efektu modelī.




Autoru ieguldījums:

Annija Tija Berņikova-Bondare: Conceptualization,Methodology,Validation, Formal analysis, Writing - Review & Editing,Visualization,Supervision,Project administration

Margarita Baranova: Conceptualization,Methodology,Validation, Formal analysis,Writing - Review & Editing, Visualization,Supervision,Project administration

Katrīna Grebeško:Writing - Original Draft,

Marta Zemīte:Writing - Original Draft,


